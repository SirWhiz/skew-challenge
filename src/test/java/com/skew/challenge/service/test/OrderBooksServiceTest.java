package com.skew.challenge.service.test;

import static org.junit.Assert.assertEquals;

import org.junit.Test;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.skew.challenge.payload.BitstampResponsePayload;
import com.skew.challenge.payload.OrderBook;
import com.skew.challenge.service.OrderBooksService;

public class OrderBooksServiceTest {

	OrderBooksService orderBooksService;

	@Test
	public void testOrderBookParsing() throws Exception {
		orderBooksService = new OrderBooksService();

		String bitstampExampleResponse = "{\"data\":{\"timestamp\":\"1607609167\",\"microtimestamp\":\"1607609167600797\",\"bids\":[[\"18160.31\",\"0.41300000\"],[\"18157.55\",\"0.68800000\"],[\"18156.40\",\"0.29649777\"],[\"18156.31\",\"0.28437635\"],[\"18156.30\",\"0.28130346\"],[\"18156.10\",\"0.68900000\"],[\"18154.91\",\"0.01400000\"],[\"18154.56\",\"1.10100000\"],[\"18154.29\",\"0.27420000\"],[\"18154.25\",\"0.16321797\"],[\"18151.90\",\"1.22100000\"],[\"18151.72\",\"1.10100000\"],[\"18151.37\",\"0.00666667\"],[\"18151.32\",\"0.16495690\"],[\"18148.75\",\"1.10100000\"],[\"18148.16\",\"0.15811000\"],[\"18147.41\",\"0.11033300\"],[\"18147.40\",\"2.06500000\"],[\"18146.93\",\"1.43000000\"],[\"18146.30\",\"0.07500000\"],[\"18146.16\",\"0.22000000\"],[\"18145.58\",\"1.39630000\"],[\"18142.43\",\"0.10000000\"],[\"18141.68\",\"0.16870000\"],[\"18141.38\",\"1.40000000\"],[\"18141.30\",\"2.74900000\"],[\"18140.48\",\"0.00666667\"],[\"18138.85\",\"0.00312179\"],[\"18138.38\",\"1.24000000\"],[\"18135.98\",\"0.27163789\"],[\"18135.94\",\"1.00000000\"],[\"18135.93\",\"1.30000000\"],[\"18135.39\",\"0.48790000\"],[\"18133.68\",\"2.78341373\"],[\"18129.07\",\"1.50000000\"],[\"18128.14\",\"2.75100000\"],[\"18127.50\",\"0.01000000\"],[\"18123.62\",\"1.40000000\"],[\"18118.94\",\"1.44000000\"],[\"18117.23\",\"1.65130000\"],[\"18111.95\",\"6.03540000\"],[\"18111.83\",\"1.30000000\"],[\"18108.61\",\"0.55318372\"],[\"18105.44\",\"0.46465565\"],[\"18105.43\",\"1.40000000\"],[\"18101.30\",\"1.70000000\"],[\"18095.18\",\"1.90000000\"],[\"18090.24\",\"6.03540000\"],[\"18088.89\",\"1.70000000\"],[\"18087.80\",\"0.37000000\"],[\"18085.98\",\"11.90500000\"],[\"18085.69\",\"3.35000000\"],[\"18084.05\",\"2.37214529\"],[\"18082.63\",\"1.85000000\"],[\"18074.02\",\"7.30000000\"],[\"18069.06\",\"17.00250000\"],[\"18068.56\",\"6.03540000\"],[\"18050.69\",\"0.13891617\"],[\"18050.67\",\"0.01500000\"],[\"18050.00\",\"0.00139001\"],[\"18047.81\",\"8.81000000\"],[\"18046.90\",\"0.00300000\"],[\"18036.63\",\"9.04000000\"],[\"18033.00\",\"0.02000000\"],[\"18030.64\",\"0.02251823\"],[\"18027.39\",\"7.20000000\"],[\"18025.27\",\"6.03240000\"],[\"18023.29\",\"1.31459691\"],[\"18017.24\",\"0.00199332\"],[\"18012.00\",\"0.03000000\"],[\"18010.00\",\"0.03560000\"],[\"18009.76\",\"43.99700000\"],[\"18008.99\",\"0.00140000\"],[\"18005.00\",\"0.84139229\"],[\"18004.00\",\"0.91130929\"],[\"18002.58\",\"0.01000000\"],[\"18002.00\",\"2.71731696\"],[\"18001.00\",\"0.01000000\"],[\"18000.00\",\"3.41457240\"],[\"17998.00\",\"0.04948160\"],[\"17996.14\",\"0.00346775\"],[\"17992.75\",\"8.67000000\"],[\"17992.27\",\"8.07540000\"],[\"17991.00\",\"0.02000000\"],[\"17990.00\",\"0.45267092\"],[\"17986.00\",\"0.01000000\"],[\"17980.00\",\"0.70269021\"],[\"17975.00\",\"0.05000000\"],[\"17973.00\",\"0.05000000\"],[\"17969.17\",\"8.39000000\"],[\"17966.00\",\"0.05000000\"],[\"17960.00\",\"0.91000000\"],[\"17957.00\",\"0.08000000\"],[\"17956.00\",\"0.50000000\"],[\"17955.00\",\"0.50000000\"],[\"17950.00\",\"1.28577619\"],[\"17948.00\",\"0.20000000\"],[\"17947.32\",\"7.00000000\"],[\"17937.80\",\"0.00521413\"],[\"17923.71\",\"0.02500000\"]],\"asks\":[[\"18164.34\",\"0.05896875\"],[\"18168.20\",\"0.27710324\"],[\"18168.24\",\"0.29106887\"],[\"18169.70\",\"2.00000000\"],[\"18170.60\",\"0.55100000\"],[\"18171.53\",\"0.28620188\"],[\"18171.54\",\"0.41300000\"],[\"18171.61\",\"0.22000000\"],[\"18172.24\",\"0.63520296\"],[\"18174.54\",\"0.68800000\"],[\"18175.65\",\"0.16330639\"],[\"18176.97\",\"0.10000000\"],[\"18177.23\",\"0.68800000\"],[\"18179.50\",\"0.32508303\"],[\"18180.04\",\"0.07500000\"],[\"18180.28\",\"0.16417238\"],[\"18181.77\",\"0.27344540\"],[\"18181.78\",\"1.64840000\"],[\"18182.53\",\"1.10100000\"],[\"18182.75\",\"0.16300000\"],[\"18182.78\",\"1.10100000\"],[\"18182.83\",\"0.02500000\"],[\"18185.23\",\"1.24000000\"],[\"18185.25\",\"0.16870000\"],[\"18185.64\",\"0.16737381\"],[\"18185.87\",\"0.01400000\"],[\"18190.51\",\"1.00000000\"],[\"18190.63\",\"1.70000000\"],[\"18191.10\",\"1.99360000\"],[\"18192.17\",\"0.16688498\"],[\"18192.62\",\"2.75200000\"],[\"18195.40\",\"0.98560000\"],[\"18196.13\",\"1.75000000\"],[\"18197.02\",\"0.16731859\"],[\"18197.28\",\"0.40367319\"],[\"18199.19\",\"4.61648212\"],[\"18201.34\",\"0.48790000\"],[\"18201.57\",\"1.90000000\"],[\"18201.94\",\"1.12468439\"],[\"18207.51\",\"2.00000000\"],[\"18207.52\",\"1.33000000\"],[\"18208.33\",\"2.75000000\"],[\"18210.73\",\"0.80000000\"],[\"18213.24\",\"1.42462719\"],[\"18213.72\",\"1.65000000\"],[\"18218.72\",\"1.40000000\"],[\"18225.25\",\"1.43000000\"],[\"18232.32\",\"1.50000000\"],[\"18233.49\",\"1.65130000\"],[\"18237.19\",\"1.41000000\"],[\"18237.96\",\"7.71980501\"],[\"18237.97\",\"3.35000000\"],[\"18241.07\",\"0.01200000\"],[\"18242.48\",\"1.20000000\"],[\"18242.75\",\"3.23951986\"],[\"18249.75\",\"1.69000000\"],[\"18250.00\",\"0.97802742\"],[\"18251.34\",\"0.01054000\"],[\"18256.00\",\"1.70000000\"],[\"18256.33\",\"8.76000000\"],[\"18259.00\",\"0.00139002\"],[\"18264.64\",\"6.00000000\"],[\"18280.00\",\"0.62377137\"],[\"18281.70\",\"17.00250000\"],[\"18282.31\",\"4.00000000\"],[\"18286.56\",\"6.00000000\"],[\"18287.42\",\"7.50000000\"],[\"18288.57\",\"9.04000000\"],[\"18290.00\",\"0.50000000\"],[\"18296.46\",\"18.13100000\"],[\"18299.00\",\"0.25503951\"],[\"18300.00\",\"2.32747264\"],[\"18305.60\",\"0.45000000\"],[\"18308.50\",\"6.00000000\"],[\"18308.68\",\"0.01300000\"],[\"18309.00\",\"0.00138003\"],[\"18313.03\",\"8.40000000\"],[\"18330.47\",\"6.00000000\"],[\"18333.00\",\"0.04375000\"],[\"18339.00\",\"1.00000000\"],[\"18346.48\",\"7.21000000\"],[\"18359.00\",\"0.00138004\"],[\"18362.03\",\"5.00000000\"],[\"18366.00\",\"0.50000000\"],[\"18371.40\",\"8.32000000\"],[\"18378.67\",\"44.58600000\"],[\"18389.70\",\"0.14854075\"],[\"18392.56\",\"6.70000000\"],[\"18397.88\",\"0.25000000\"],[\"18400.00\",\"0.22149535\"],[\"18409.00\",\"0.00138005\"],[\"18420.31\",\"7.99000000\"],[\"18434.82\",\"0.11000000\"],[\"18439.77\",\"0.02500000\"],[\"18440.00\",\"0.02441052\"],[\"18450.00\",\"0.00269961\"],[\"18455.00\",\"0.21000000\"],[\"18455.60\",\"7.45000000\"],[\"18459.00\",\"0.00137006\"],[\"18460.00\",\"0.99133442\"]]},\"channel\":\"order_book_btcusd\",\"event\":\"data\"}";
		String orderBookJson = "{\"exchange\":\"Bitstamp\",\"symbol\":\"BTC/USD\",\"bids\":[{\"quantity\":0.413,\"price\":18160.31},{\"quantity\":0.688,\"price\":18157.55}],\"asks\":[{\"quantity\":0.05896875,\"price\":18164.34},{\"quantity\":0.27710324,\"price\":18168.2}]}";
		OrderBook parsedOrderBook = new ObjectMapper().readValue(orderBookJson, OrderBook.class);

		BitstampResponsePayload data = new ObjectMapper().readValue(bitstampExampleResponse,
				BitstampResponsePayload.class);
		orderBooksService.parseOrderBook(data);

		assertEquals(1, orderBooksService.getAmountOfBooks());
		assertEquals(orderBooksService.getOrderBooks().get(0), parsedOrderBook);
	}

}
